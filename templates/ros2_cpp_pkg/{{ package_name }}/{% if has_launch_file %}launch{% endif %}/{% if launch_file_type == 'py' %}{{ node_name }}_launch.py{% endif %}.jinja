#!/usr/bin/env python3

import os
from ament_index_python import get_package_share_directory
from launch import LaunchDescription
{% if is_lifecycle %}
from launch.actions import DeclareLaunchArgument, GroupAction
from launch.conditions import LaunchConfigurationNotEquals
from launch.substitutions import LaunchConfiguration
from launch_ros.actions import LifecycleNode, SetParameter
{% else %}
from launch.actions import DeclareLaunchArgument
from launch.substitutions import LaunchConfiguration
from launch_ros.actions import Node
{% endif %}

def generate_launch_description():

    name_arg = DeclareLaunchArgument("name", default_value="{{ node_name }}")
    namespace_arg = DeclareLaunchArgument("namespace", default_value="")

{% if has_params %}
    config = os.path.join(
        get_package_share_directory("{{ package_name }}"),
        "config",
        "params.yaml"
    )

{% endif %}
{% if is_lifecycle %}
    startup_state_arg = DeclareLaunchArgument('startup_state',
                                              default_value='None')
    node = LifecycleNode(
        package="{{ package_name }}",
        executable="{{ node_name }}",
        namespace=LaunchConfiguration("namespace"),
        name=LaunchConfiguration("name"),
        output="screen",
        emulate_tty=True,
{% if has_params %}
        parameters=[config]
{% endif %}
    )
    node_group = GroupAction(actions=[
        SetParameter(name='startup_state',
                     value=LaunchConfiguration('startup_state'),
                     condition=LaunchConfigurationNotEquals(
                         'startup_state', "None")), node
    ])

    return LaunchDescription([
        startup_state_arg,
        node_group
    ])
{% else %}

    return LaunchDescription([
        Node(
            package="{{ package_name }}",
            executable="{{ node_name }}",
            namespace=LaunchConfiguration("namespace"),
            name=LaunchConfiguration("name"),
            output="screen",
            emulate_tty=True,
{% if has_params %}
            parameters=[config]
{% endif %}
        )
    ])
{% endif %}
